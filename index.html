<!DOCTYPE html>
<html>
<head>
    <title>Reset Password</title>
    <style>
        /* Your CSS styles here */
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Proxima+Nova:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <img src="icon.png" alt="MyFund Logo" class="logo">
        <h2 class="header">Reset Password</h2>
        <p class="subText">Enter your new password and confirm it to get a new MyFund password. Login on the app with it once you get a "success" message.</p>
        <form id="reset-form">
            <div class="password-toggle">
                <input type="password" id="new-password" placeholder="New Password" required>
                <span class="toggle-icon" id="toggle-new-password">
                    <img src="eye_closed.png" alt="Toggle New Password">
                </span>
            </div>
            <div class="password-toggle">
                <input type="password" id="confirm-password" placeholder="Confirm Password" required>
                <span class="toggle-icon" id="toggle-confirm-password">
                    <img src="eye_closed.png" alt="Toggle Confirm Password">
                </span>
            </div>
            <button type="submit" id="reset-button">Update Password Now!</button>
        </form>
    </div>

    <script>
        const togglePassword = (inputId, toggleIconId) => {
            // ... (unchanged)
        };
    
        togglePassword('new-password', 'toggle-new-password');
        togglePassword('confirm-password', 'toggle-confirm-password');
    
        // Extract token from URL parameters
        const urlSearchParams = new URLSearchParams(window.location.search);
        const token = urlSearchParams.get('token');
        console.log('Token:', token);

        if (!token) {
            alert('Token not found in URL.');
        }
    
        const resetForm = document.getElementById('reset-form');
        resetForm.addEventListener('submit', async (event) => {
            event.preventDefault();
    
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
    
            if (newPassword === confirmPassword && token) {
                try {
                    const response = await fetch(`http://192.168.84.34:8000/api/reset-password/?token=${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password: newPassword, confirm_password: confirmPassword }),
                    });
    
                    console.log('Response status:', response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Response data:', data);
    
                        if (data.message) {
                            alert('Password reset successful. Return to the MyFund App to login with your new password.');
                            // You can also redirect the user to the login page here if needed
                        } else if (data.error) {
                            alert(data.error);
                        } else {
                            alert('Password reset failed.');
                        }
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            } else {
                alert('Passwords do not match or token is missing.');
            }
        });
    </script>
  
</body>
</html>
